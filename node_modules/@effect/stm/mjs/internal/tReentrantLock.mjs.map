{"version":3,"file":"tReentrantLock.mjs","names":["Equal","dual","HashMap","Option","Effect","FiberId","core","tRef","TReentrantLockSymbolKey","TReentrantLockTypeId","Symbol","for","WriteLockTypeId","ReadLockTypeId","TReentranLockImpl","constructor","state","_a","ReadLock","readers","_b","readLocks","Array","from","reduce","acc","curr","writeLocks","readLocksHeld","fiberId","getOrElse","get","writeLocksHeld","_fiberId","WriteLock","_c","equals","isReadLock","lock","isWriteLock","emptyReadLock","empty","makeReadLock","count","make","noOtherHolder","readLock","isEmpty","size","has","adjustReadLock","adjustment","total","newTotal","Error","remove","set","adjustRead","self","delta","withSTMRuntime","runtime","unsafeGet","journal","result","unsafeSet","succeed","threadName","retry","acquireRead","acquireWrite","fiberReadLocks","effect","fiberWriteLocks","writeLock","locked","zipWith","readLocked","writeLocked","x","y","map","acquireRelease","commit","releaseRead","releaseWrite","withLock","withWriteLock","withReadLock","uninterruptibleMask","restore","zipRight","ensuring"],"sources":["../../../src/internal/tReentrantLock.ts"],"sourcesContent":[null],"mappings":"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"}